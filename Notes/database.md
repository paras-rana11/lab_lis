ğŸ“„ Program Overview: Machine Data Parser & MySQL Inserter

ğŸ”§ Purpose:  
This program monitors a local folder for result files generated by lab analyzers (like Hemax 330, Sysmex XP-100, etc.), extracts patient test results, and saves them to a MySQL database. It supports file parsing, JSON formatting, and robust error handling.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  
ğŸ” Execution Flow:

1. Set DB credentials and folder path
2. Loop indefinitely:
   - List all files in the input folder
   - For each file:
     - Detect analyzer by filename prefix
     - Parse test data using correct extractor
     - Format data into [machineName, patientId, testData]
     - Insert into MySQL via prepared statement
     - Optionally delete processed file
3. Sleep 2 seconds and repeat

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  
ğŸ”§ Key Classes & Functions:

âœ… get_connection()  
â€¢ Establishes connection to MySQL database  
â€¢ Uses credentials defined at top of script

âœ… send_to_mysql(data)  
â€¢ Accepts [machineName, patientId, testDataDict]  
â€¢ Converts to JSON and inserts into machineData table  
â€¢ Logs error if DB connection or insert fails

âœ… extract_report_data_<machine>()  
â€¢ Custom extractor for each analyzer  
â€¢ Extracts patient ID and test data from text  
â€¢ Returns a list of [machine, patient_id, test_dict]  
â€¢ Examples:
  - extract_report_data_xn_330()
  - extract_report_data_bc_5150()

âœ… process_all_files(folder_path)  
â€¢ Main parser logic  
â€¢ Scans for files, detects machine type, extracts and inserts  
â€¢ Skips or logs errors gracefully  
â€¢ Supports file cleanup after insertion

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  
ğŸ“¦ Example File Handling Flow:

| Filename Prefix | Machine       | Handler Function               |
|-----------------|---------------|--------------------------------|
| xn_330_         | Sysmex XN-330 | extract_report_data_xn_330()  |
| bc_5150_        | Mindray BC-5150| extract_report_data_bc_5150() |
| hemax_330_      | Hemax 330     | extract_report_data_hemax_330()|

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  
ğŸ—ƒï¸ MySQL Table Used:

machineData  
| Column      | Type     | Description                      |
|-------------|----------|----------------------------------|
| machineName | VARCHAR  | Name/ID of the analyzer          |
| patientId   | VARCHAR  | Unique patient or sample ID      |
| test        | JSON     | Test name/value pairs in JSON    |

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  
ğŸ“ Default Paths:

| Purpose          | Path                                                                 |
|------------------|----------------------------------------------------------------------|
| Report Folder    | /home/.../attachments/ (Set via folder_path)                        |
| Processed Output | Inserted into MySQL only (optionally remove files after processing) |

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  
ğŸ“¬ Email Alert Setup:
(Optional â€“ implement in send_mail_or_logging() if needed)

| Field       | Description                           |
|-------------|----------------------------------------|
| FROM_EMAIL  | Your sender email                      |
| TO_EMAIL    | Alert destination                      |
| PASSWORD    | App password / SMTP pass               |
| SMTP Server | smtp.gmail.com + TLS (port 587)        |

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  
ğŸ› ï¸ Setup Instructions:

1. Install required package:
   pip install mysql-connector-python

2. Update these values in the script:
   - my_host, my_user, my_pass, my_db
   - folder_path

3. Run the script:
   python machine_data_parser.py

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  
ğŸ“Œ Debug Tips:

â€¢ Use print(repr(text_data)) to inspect raw file content  
â€¢ Enable logging to record failures  
â€¢ Use print(result) to inspect parsed JSON data before DB insert  
â€¢ Uncomment os.remove() to clean up processed files  

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”